# Mock for NgRx [SignalStore](signalStore)

## Installation

### PNPM

`pnpm add ngx-mock-signal-store --dev`

### NPM

`npm install ngx-mock-signal-store --save-dev`

### Yarn

`yarn add ngx-ngrx-component-store-debug-tools --dev`

## Unit test example

To run the unit tests for the demo app, use the `ng test demo` command.

### Article list component

In the demo app, we have [ArticleListComponent_SS](https://github.com/gergelyszerovay/mock-stores/blob/article-angular-libraries/projects/demo/src/app/article-list-ngrx-signal-store/article-list-signal-store.component.ts) component. It's a smart component and has a a component level store, [ArticleListSignalStore](https://github.com/gergelyszerovay/mock-stores/blob/article-angular-libraries/projects/demo/src/app/article-list-ngrx-signal-store/article-list-signal-store.store.ts).

The component has two signal inputs, the component gets these from the router:

- `selectedPage`
- `pageSize`

The component renders the following dumb compoents, based on the state in the store:

- an article list dumb component
- and a paginator component dumb component

The component updates the state of the Store, when:
- the `selectedPage` or `pageSize` values change on the URL
- or the user changes the selected page on the pagination component

### SignalStore for the Article list component

The store has the following state:

```ts
export type ArticleListState = {
  readonly selectedPage: number,
  readonly pageSize: number,

  readonly httpRequestState: HttpRequestState,

  readonly articles: Articles,
  readonly articlesCount: number
}
```

It also has:
- computed selectors: `totalPages` and `withComputed`
- methods for updating its state: `setSelectedPage`, `setPageSize`, `setRequestStateLoading`, `setRequestStateSuccess`, `setRequestStateError`
- and an `rxMethod` for fetching the article list from the `ArticlesService`: `loadArticles`

### Providing a mock SignalStore in a unit test

We can use the `provideMockSignalStore` function for providing a mocked version of the store. The function has two parameters: the first is a signal store, the object returned by `signalStore`, and the second is an object with configuration parameters:

- `initialStatePatch`: optional object, if it's set, `provideMockSignalStore` patches the initial values of the store with these values

- `initialComputedValues`: object, we have to specify an initial value for each mocked  computed selectors (generated by `withComputed`)
- `mockComputedSignals`: 
  - it's `true` by default, in this case `provideMockSignalStore` mocks all the computed selectors with a `WritableSignal`.
  - if it's `false`, `provideMockSignalStore` doesn't mock the computed selectors

- `mockRxMethods`: boolean, `true` by default, in this case `provideMockSignalStore` mocks all the functions with `FakeRxMethod`s
- `mockMethods`: boolean, `true` by default, in this case `provideMockSignalStore` mocks all the functions with Sinon `fake`s

TODO: FakeRxMethod


```ts
describe('ArticleListComponent_SS', () => {
  let component: ArticleListComponent_SS;
  let fixture: ComponentFixture<ArticleListComponent_SS>;
  let store: UnwrapProvider<typeof ArticleListSignalStore>;
  let mockStore: MockSignalStore<typeof store>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [
        ArticleListComponent_SS,
        MockComponent(UiArticleListComponent)
      ],
      providers: [
      ]
    })
    .overrideComponent(
      ArticleListComponent_SS,
      {
        set: {
          providers: [            
            MockProvider(ArticlesService), // injected in ArticleListSignalStore
            provideMockSignalStore(ArticleListSignalStore, {
              initialComputedValues: {
                totalPages: 0,
                pagination: { selectedPage: 0, totalPages: 0 }
              }
            })
          ]
        }
      }
    )
    .compileComponents();

    fixture = TestBed.createComponent(ArticleListComponent_SS);
    component = fixture.componentInstance;
    // TODO: not works
    // store = TestBed.inject(ArticleListSignalStore);
    store = component.store;
    mockStore = asMockSignalStore(store);
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
}
```
